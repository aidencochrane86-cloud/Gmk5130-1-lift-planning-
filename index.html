<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Lift Planner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  padding:16px;
}
.card {
  background:#fff;
  padding:16px;
  margin-bottom:16px;
  border-radius:8px;
}
label {
  display:block;
  margin-top:10px;
  font-weight:bold;
}
input[type="number"], select {
  width:100%;
  padding:6px;
  margin-top:4px;
}
input::placeholder {
  color:#999;
  font-style:italic;
}
.meta {
  font-size:0.9em;
  background:#eef6ff;
  padding:8px;
  border-radius:6px;
}
.badge {
  display:inline-block;
  margin-top:6px;
  padding:4px 8px;
  color:#fff;
  border-radius:12px;
  font-size:0.8em;
}
.badge.basic { background:#0066cc; }
.badge.boom { background:#555; }
.fail { color:#b42318; font-weight:bold; }
.advice { color:#555; font-size:0.9em; }

.util-green { color:#1a7f37; font-weight:bold; }
.util-amber { color:#b26a00; font-weight:bold; }
.util-red   { color:#b42318; font-weight:bold; }
</style>
</head>

<body>

<div class="card meta">
  <strong>Crane:</strong> GMK5130-1<br>
  <strong>Slew:</strong> 360°<br>
  <span id="metaBallast"><strong>Ballast:</strong> —</span><br>
  <span id="modeBadge" class="badge basic">Mode: Basic Mode</span>
</div>

<div class="card">
<h2>Inputs</h2>

<label><input type="radio" name="mode" value="optimised" checked> Basic Mode</label>
<label><input type="radio" name="mode" value="boom"> Boom-specific</label>

<label>Ballast</label>
<select id="ballast">
  <option value="40_1t">40.1t</option>
  <option value="23_5t">23.5t</option>
  <option value="6t">6t</option>
</select>

<label>Load (t)</label>
<input id="load" type="number">

<label>Working Radius (m)</label>
<input id="radius" type="number">
</div>

<div class="card">
<h2>Result</h2>
<div id="result">Select inputs.</div>
</div>

<script>
const BOOM_FOOT_HEIGHT = 2.0;
let DATA = [], META = {};

const ballast = document.getElementById("ballast");
const loadInput = document.getElementById("load");
const radiusInput = document.getElementById("radius");
const result = document.getElementById("result");
const metaBallast = document.getElementById("metaBallast");

function loadData(key) {
  fetch(`loadchart_${key}.json`)
    .then(r => r.json())
    .then(d => {
      DATA = d.charts;
      META = d.meta || {};
      let h = `<strong>Ballast:</strong> ${ballast.selectedOptions[0].text}`;
      if (META.outriggers) h += `<br><strong>Outriggers:</strong> ${META.outriggers}`;
      if (META.sli) h += `<br><strong>SLI:</strong> ${META.sli}`;
      metaBallast.innerHTML = h;
      calculate();
    });
}

function calculate() {
  const load = +loadInput.value;
  const radius = +radiusInput.value;
  if (!load || !radius) return;

  let candidates = DATA.filter(r => r.radius >= radius && r.capacity >= load)
    .map(r => ({
      boom: r.boom,
      config: r.config,
      util: load / r.capacity * 100,
      radius: r.radius
    }))
    .sort((a,b)=>a.util-b.util);

  if (!candidates.length || candidates[0].util > 90) {
    let html = `
      <h3 class="fail">Lift is not possible with the selected ballast</h3>
      <p>Utilisation exceeds planning limit (90%).</p>
    `;

    // Same-ballast recovery
    const recovery = DATA
      .map(r => ({
        radius: r.radius,
        util: load / r.capacity * 100
      }))
      .filter(r => r.util <= 90)
      .sort((a,b)=>b.radius-a.radius)[0];

    if (recovery) {
      html += `
        <p class="advice"><b>Same ballast option:</b>
        Reduce radius to ${recovery.radius} m
        (utilisation ${recovery.util.toFixed(1)}%).</p>
      `;
    }

    // Higher ballast advisory
    html += `
      <p class="advice"><b>Higher ballast may be required</b>
      to achieve the requested radius.</p>
    `;

    result.innerHTML = html;
    return;
  }

  const best = candidates[0];
  result.innerHTML = `
    <h3>Basic Mode Result</h3>
    <p><b>Configuration:</b> ${best.config}</p>
    <p><b>Boom length:</b> ${best.boom} m</p>
    <p><b>Ballast:</b> ${ballast.selectedOptions[0].text}</p>
    <p><b>Outriggers:</b> ${META.outriggers || "—"}</p>
    <p><b>Utilisation:</b> ${best.util.toFixed(1)}%</p>
    <p><b>SLI code:</b> ${META.sli || "—"}</p>
  `;
}

[loadInput, radiusInput].forEach(e => e.addEventListener("input", calculate));
ballast.addEventListener("change", () => loadData(ballast.value));

loadData(ballast.value);
</script>

</body>
</html>

